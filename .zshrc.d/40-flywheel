# ACFS loader
source "$HOME/.acfs/zsh/acfs.zshrc"

# bun completions for zsh
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
#safe_add_to_path "$BUN_INSTALL/bin"

#. "$HOME/.local/bin/env"

. "$HOME/.atuin/bin/env"

# opencode (must be before ntm shell integration)
safe_add_to_path $HOME/.opencode/bin

eval "$(ntm shell zsh)"

# Atuin init handled by .zshrc.d/atuin

unalias br 2>/dev/null  # br installer - remove conflicting alias

alias am='cd "$HOME/mcp_agent_mail" && scripts/run_server_with_token.sh'

# >>> system_resource_protection_script >>>
# Resource-limited command runners using systemd user scopes (if available)
if command -v systemd-run >/dev/null 2>&1; then
  alias limited="systemd-run --user --scope -p CPUQuota=50% --"
  alias limited-mem="systemd-run --user --scope -p MemoryMax=8G --"
  alias cargo-limited="systemd-run --user --scope -p CPUQuota=75% -p MemoryMax=50G cargo"
  alias make-limited="systemd-run --user --scope -p CPUQuota=75% make -j$(nproc)"
  alias node-limited="systemd-run --user --scope -p CPUQuota=75% -p MemoryMax=8G node"
fi

# Monitoring helpers (only if helpers are available)
if command -v sysmoni >/dev/null 2>&1; then
  alias sys='sysmoni'
fi
if command -v check-throttled >/dev/null 2>&1; then
  alias throttled='check-throttled'
fi

# Rust / Cargo env
export TMPDIR=/tmp
export CARGO_TARGET_DIR=/tmp/cargo-target
# <<< system_resource_protection_script <<<
